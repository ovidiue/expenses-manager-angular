<div class="container" [@fadeIn]>
  <div class="page-title">
    <h3>Categories</h3>
  </div>

  <div class="row">
    <p-overlayPanel #op>
      <p-scrollPanel [style]="{width: '300px', height: '200px'}">
        <div style="padding:1em;line-height:1.5">
          {{selectedDescription}}
        </div>
      </p-scrollPanel>
    </p-overlayPanel>
    <div class="table-wrapper mt-5 mb-5">
      <div class="col">
        <p-toolbar>
          <div class="ui-toolbar-group-right">
            <p-dialog [style]="{width: '425px'}"
                      [rtl]="true"
                      modal="true"
                      positionTop="50"
                      [visible]="displayDeleteModal"
                      [header]="'Confirm DELETE'">
              <span>{{deletionText}}</span>
              <p>This action can not be undone!</p>
              <p-footer>
                <button type="button"
                        [class]="'ui-button-secondary float-left ui-button-secondary ui-button-raised'"
                        pButton
                        icon="pi pi-times"
                        label="Cancel"
                        (click)="resetDeletionVariables()">
                </button>
                <button type="button"
                        [class]="'ui-button-danger ui-button-raised'"
                        pButton
                        icon="pi pi-check"
                        label="Delete"
                        (click)="deleteCategory(false)">
                </button>
                <button type="button"
                        [class]="'ui-button-danger ui-button-raised'"
                        pButton
                        pTooltip="This will delete attached expenses, and the rates attached to those expenses!"
                        icon="pi pi-check"
                        label="Delete expenses too"
                        (click)="deleteCategory(true)">
                </button>
              </p-footer>
            </p-dialog>
            <button type="button"
                    (click)="displayDeleteModal=true"
                    pButton
                    [disabled]="!selectedCategories.length"
                    class="ui-button-raised ui-button-danger"
                    label="Delete">
            </button>
            <button pButton type="button"
                    routerLink="add"
                    label="Add Category"
                    class="ui-button-raised">
            </button>
          </div>
        </p-toolbar>

      </div>
      <div class="col">
        <p-table [value]="categories"
                 [paginator]="true"
                 [lazy]="true"
                 [rows]="10"
                 (onLazyLoad)="getCategories($event)"
                 [totalRecords]="totalTableRecords"
                 [loading]="loading"
                 [rowsPerPageOptions]="rowsPerPageOptions"
                 [(selection)]="selectedCategories">
          <ng-template pTemplate="header" let-cat>
            <tr>
              <th style="width: 3em">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th [pSortableColumn]="'name'">
                Name
                <p-sortIcon [field]="'name'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'description'">
                Description
                <p-sortIcon [field]="'description'"></p-sortIcon>
              </th>
              <th [pSortableColumn]="'color'">
                Color
                <p-sortIcon [field]="'color'"></p-sortIcon>
              </th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-cat>
            <tr [pSelectableRow]="cat">
              <td>
                <p-tableCheckbox [value]="cat"></p-tableCheckbox>
              </td>
              <td>{{cat.name}}</td>
              <td>
                <div *ngIf="cat.description && cat.description.length > 15; else smallerDesc"
                     style="cursor:pointer;"
                     pTooltip="Click for detailed info"
                     (click)="selectedDescription=cat.description;op.toggle($event)">
                  {{cat.description.length > 15 ? (cat.description | slice:0:20)+'...' :
                  cat.description}}
                </div>
                <ng-template #smallerDesc>
                  <div>
                    {{cat.description}}
                  </div>
                </ng-template>
              </td>
              <td>
                <div [ngStyle]="{'background':cat.color}" class="table-cell-color"></div>
              </td>
              <td class="text-center">
                <button pButton
                        class="ui-button-info"
                        type="button"
                        routerLink="add/{{cat.id}}"
                        icon="pi pi-pencil"
                        iconPos="left"></button>
                <button pButton
                        class="ui-button-danger"
                        type="button"
                        (click)="selectedForDeletion=cat;displayDeleteModal=true"
                        icon="pi pi-trash"
                        iconPos="left"></button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

    </div>
  </div>


</div>


