<div class="container">
  <div class="page-title">
    <h3>Expenses</h3>
  </div>

  <div class="row">
    <p-overlayPanel #op>
      <p-scrollPanel [style]="{width: '300px', height: '200px'}">
        <div style="padding:1em;line-height:1.5">
          {{selectedDescription}}
        </div>
      </p-scrollPanel>
    </p-overlayPanel>
    <div class="table-wrapper mt-5 mb-5">
      <div class="col">
        <p-toolbar>
          <div class="ui-toolbar-group-right">
            <p-dialog [style]="{width: '425px'}"
                      [rtl]="true"
                      modal="true"
                      positionTop="50"
                      [visible]="displayDelete"
                      [header]="'Confirm DELETE'">
              <span>{{deletionText}}</span>
              <p>This action can not be undone!</p>
              <p-footer>
                <button type="button"
                        [class]="'ui-button-secondary float-left ui-button-secondary ui-button-raised'"
                        pButton
                        icon="pi pi-times"
                        label="Cancel"
                        (click)="resetDeletionVariables()">
                </button>
                <button type="button"
                        [class]="'ui-button-danger ui-button-raised'"
                        pButton
                        icon="pi pi-check"
                        label="Delete"
                        (click)="displayDelete=true; deleteExpense()">
                </button>
                <button type="button"
                        [class]="'ui-button-danger ui-button-raised'"
                        pButton
                        *ngIf="decideVisibilityAccordingToPayedField()"
                        icon="pi pi-check"
                        label="Delete rates too"
                        (click)="deleteExpenseAndRates()">
                </button>
              </p-footer>
            </p-dialog>
            <button type="button"
                    (click)="displayDeleteMultiple()"
                    pButton
                    [disabled]="!selectedExpenses.length"
                    class="ui-button-raised ui-button-danger"
                    label="Delete">
            </button>
            <button pButton type="button"
                    routerLink="add"
                    label="Add Expense"
                    class="ui-button-raised">
            </button>
          </div>
        </p-toolbar>

      </div>
      <div class="col">
        <p-table [value]="expenses"
                 [responsive]="true"
                 [paginator]="true"
                 [rows]="10"
                 [(selection)]="selectedExpenses">
          <ng-template pTemplate="header">
            <tr>
              <th style="width: 3em">
                <p-tableHeaderCheckbox></p-tableHeaderCheckbox>
              </th>
              <th>Title</th>
              <th>Amount</th>
              <th>Description</th>
              <th>Recurrent</th>
              <th>Created on</th>
              <th>Due date</th>
              <th>Category</th>
              <th>Tags</th>
              <th>Payed</th>
              <th>Actions</th>
            </tr>
          </ng-template>
          <ng-template pTemplate="body" let-exp>
            <tr [pSelectableRow]="exp">
              <td>
                <p-tableCheckbox [value]="exp"></p-tableCheckbox>
              </td>
              <td>{{exp.title}}</td>
              <td>{{exp.amount}}</td>
              <td>
                <div *ngIf="exp.description && exp.description.length > 15; else smallerDesc"
                     style="cursor:pointer;"
                     pTooltip="Click for detailed info"
                     (click)="selectedDescription=exp.description;op.toggle($event)">
                  {{exp.description.length > 15 ? (exp.description | slice:0:20)+'...' :
                  exp.description}}
                </div>
                <ng-template #smallerDesc>
                  <div>
                    {{exp.description}}
                  </div>
                </ng-template>
              </td>
              <td>{{exp.recurrent}}</td>
              <td>{{exp.createdOn | date}}</td>
              <td>{{exp.dueDate | date}}</td>
              <td>
                <span *ngIf="exp.category && exp.category.name"
                      class="bottom-bradius"
                      [ngStyle]="{'border-bottom': '8px solid' + exp.category.color}">
                  {{exp.category.name}}
                </span>
              </td>
              <td>
                <div *ngIf="exp.tags && exp.tags.length">
                  <div *ngFor="let tag of exp.tags"
                       class="bottom-bradius"
                       [ngStyle]="{'border-bottom': '8px solid' + tag.color}">
                    {{tag.name}}
                  </div>
                </div>
              </td>
              <td>{{exp.payed}}</td>

              <td class="text-center">
                <button pButton
                        pTooltip="Edit"
                        class="ui-button-info ui-button-raised"
                        type="button"
                        routerLink="add/{{exp.id}}"
                        icon="pi pi-pencil"
                        iconPos="left">
                </button>
                <button pButton
                        pTooltip="Delete"
                        class="ui-button-danger ui-button-raised"
                        type="button"
                        (click)="displayDeleteRow(exp)"
                        icon="pi pi-trash"
                        iconPos="left">
                </button>
                <button *ngIf="exp.payed > 0"
                        pTooltip="Display rates"
                        pButton
                        class="ui-button-secondary ui-button-raised"
                        type="button"
                        (click)="fetchAndDisplayRates(exp)"
                        icon="pi pi-sitemap"
                        iconPos="left">
                </button>
              </td>
            </tr>
          </ng-template>
        </p-table>
      </div>

    </div>
  </div>
</div>
